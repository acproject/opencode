#!/bin/sh
EXPECTED_VERSION=$(grep '"packageManager"' package.json | sed 's/.*"bun@\([^"]*\)".*/\1/')
CURRENT_VERSION=$(bun --version)
EXPECTED_MAJOR=$(echo "$EXPECTED_VERSION" | cut -d. -f1)
CURRENT_MAJOR=$(echo "$CURRENT_VERSION" | cut -d. -f1)

if [ "$CURRENT_MAJOR" != "$EXPECTED_MAJOR" ]; then
  echo "Error: Bun major version $CURRENT_VERSION does not match expected $EXPECTED_VERSION from package.json"
  exit 1
fi

if [ "$CURRENT_VERSION" != "$EXPECTED_VERSION" ]; then
  echo "Warning: Bun version $CURRENT_VERSION differs from expected $EXPECTED_VERSION from package.json"
fi

bun run --cwd packages/opencode typecheck
